<?php if (!empty($tags)): ?>
    <div class="d-flex align-items-center">
        <span class="me-3 text-muted small">Filter by tags:</span>
        <div class="d-flex flex-wrap gap-1">
            <?php foreach ($tags as $tag): ?>
                <?php $isSelected = in_array($tag->name, $selectedTags); ?>
                <div class="btn-group" role="group">
                    <?php
                    // Build the new selected tags array.
                    // If the tag is already selected, remove it from the array.
                    // If the tag is not selected, add it to the array.
                    $updatedTagSelection = $isSelected
                        ? array_filter($selectedTags, fn($t) => $t !== $tag->name)
                        : [...$selectedTags, $tag->name];

                    // Build the query parameters
                    $queryParams['tags'] = $updatedTagSelection;
                    ?>
                    <a href="?<?= http_build_query($queryParams) ?>"
                        class="btn btn-sm <?= $isSelected ? 'btn-primary' : 'btn-outline-primary' ?>">
                        <?= $this->e($tag->name) ?>
                    </a>
                </div>
            <?php endforeach; ?>
            <?php if (!empty($selectedTags)): ?>
                <?php
                $clearFilterParams = $_GET;
                unset($clearFilterParams['tags']);
                ?>
                <a href="?<?= http_build_query($clearFilterParams) ?>" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-times me-1"></i>Clear
                </a>
            <?php endif; ?>
        </div>
    </div>
<?php endif; ?>




<?php if (!empty($selectedTags)): ?>
    <div class="alert alert-info mb-3">
        <i class="fas fa-filter me-2"></i>
        Showing <?= count($urls) ?> URL<?= count($urls) !== 1 ? 's' : '' ?> with tags:
        <?php foreach ($selectedTags as $tagName): ?>
            <span class="badge bg-primary me-1"><?= $this->e($tagName) ?></span>
        <?php endforeach; ?>
        <?php
        $clearParams = $_GET;
        unset($clearParams['tags']);
        ?>
        <a href="?<?= http_build_query($clearParams) ?>" class="btn btn-sm btn-outline-info ms-2">Clear filters</a>
    </div>
<?php endif; ?>
